{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\Script\\Model\\Dialog\\iMessage/assets\\Script\\Model\\Dialog\\iMessage\\iMessage.js"],"names":["Helper","require","cc","Class","extends","Component","properties","news","Label","text","item","Prefab","content","Node","message","onLoad","onEnable","RedT","send","update","onData","data","list","countNews","string","node","active","destroyAllChildren","self","Promise","all","map","mail","instantiate","getComponent","init","title","time","getStringDateByTime","bg","read","dot","_id","addChild","onContentClick","obj","audio","playClick","getContent","children","filter","then","result","length","view","reset","count"],"mappings":"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","file":"iMessage.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Script\\Model\\Dialog\\iMessage","sourcesContent":["\r\nvar Helper = require('Helper');\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tnews:    cc.Label,\r\n\t\ttext:    cc.Label,\r\n\t\titem:    cc.Prefab,\r\n\t\tcontent: cc.Node,\r\n\t\tmessage: '',\r\n\t},\r\n\tonLoad(){\r\n\r\n\t},\r\n\tonEnable: function () {\r\n\t\tcc.RedT.send({message:{update: true}});\r\n\t},\r\n\tonData: function(data) {\r\n\t\tif (!!data.list) {\r\n\t\t\tthis.list(data.list);\r\n\t\t\tthis.countNews(data.list);\r\n\t\t}\r\n\t\tif (!!data.text) {\r\n\t\t\tthis.text.string = data.text;\r\n\t\t}\r\n\t\tif (!!data.news) {\r\n\t\t\tif (data.news > 0) {\r\n\t\t\t\tthis.news.node.active = true;\r\n\t\t\t\tthis.news.string = data.news;\r\n\t\t\t}else{\r\n\t\t\t\tthis.news.node.active = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tlist: function(list){\r\n\t\tthis.content.destroyAllChildren();\r\n\t\tvar self = this;\r\n\t\tPromise.all(list.map(function(mail){\r\n\t\t\tlet item = cc.instantiate(self.item);\r\n\t\t\titem = item.getComponent('iMessage_item');\r\n\t\t\titem.init(self);\r\n\t\t\titem.title.string = mail.title;\r\n\t\t\titem.time.string  = Helper.getStringDateByTime(mail.time);\r\n\t\t\titem.bg.active    = !mail.read;\r\n\t\t\titem.dot.active   = (self.message == mail._id);\r\n\t\t\titem.message      = mail._id;\r\n\t\t\tself.content.addChild(item.node);\r\n\t\t}));\r\n\t},\r\n\tonContentClick: function(obj){\r\n\t\tif (obj.message != this.message) {\r\n\t\t\tobj.bg.active = false;\r\n\t\t\tcc.RedT.audio.playClick();\r\n\t\t\tthis.message = obj.message;\r\n\t\t\tthis.getContent();\r\n\r\n\t\t\tobj.dot.active = true;\r\n\r\n\t\t\tPromise.all(this.content.children.filter(function(node){\r\n\t\t\t\tif (node != obj.node) {\r\n\t\t\t\t\tnode.children[0].active = false;\r\n\t\t\t\t}\r\n\t\t\t\treturn node.children[1].active;\r\n\t\t\t}))\r\n\t\t\t.then(result => {\r\n\t\t\t\tresult = result.length;\r\n\t\t\t\tif (result > 0) {\r\n\t\t\t\t\tthis.news.node.active = true;\r\n\t\t\t\t\tthis.news.string = result;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.news.node.active = false;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tgetContent: function(obj){\r\n\t\tcc.RedT.send({message:{view: this.message}});\r\n\t},\r\n\treset: function(){\r\n\t\tthis.content.destroyAllChildren();\r\n\t\tthis.text.string = this.news.string = \"\";\r\n\t\tthis.news.node.active = false;\r\n\t},\r\n\tcountNews: function(data){\r\n\t\tlet count = data.filter(function(obj){\r\n\t\t\treturn !obj.read;\r\n\t\t});\r\n\t\tcount = count.length;\r\n\t\tif (count > 0) {\r\n\t\t\tthis.news.node.active = true;\r\n\t\t\tthis.news.string = count;\r\n\t\t}else{\r\n\t\t\tthis.news.node.active = false;\r\n\t\t}\r\n\t},\r\n});\r\n"]}