{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\Script\\Game\\TaiXiu\\TaiXiuChat/assets\\Script\\Game\\TaiXiu\\TaiXiuChat\\TaiXiuChat.js"],"names":["helper","require","BrowserUtil","cc","Class","extends","Component","properties","content","default","type","ScrollView","item","Prefab","input","EditBox","layout","Layout","isLoad","init","obj","RedT","setting","taixiu","chat_active","node","active","onLoad","self","keyHandle","t","keyCode","macro","KEY","tab","preventDefault","enter","focusGame","onChatClick","onEnable","sys","isBrowser","addEvent","getData","scrollToBottom","onDisable","removeEvent","clean","getHTMLElementByEditBox","addEventListener","removeEventListener","send","getLogChat","message","data","tobot","instantiate","itemComponent","getComponent","Label","top","string","user","value","name","children","color","Color","addChild","height","position","y","setTimeout","bind","logs","length","Promise","all","map","then","onData","isEmpty","err","chat","toggle","setTop","audio","playClick","reset","destroyAllChildren"],"mappings":"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","file":"TaiXiuChat.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Script\\Game\\TaiXiu\\TaiXiuChat","sourcesContent":["\r\nvar helper      = require('Helper');\r\nvar BrowserUtil = require('BrowserUtil');\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\tproperties: {\r\n\t\tcontent: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.ScrollView\r\n\t\t},\r\n\t\titem: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.Prefab\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.EditBox\r\n\t\t},\r\n\t\tlayout: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.Layout\r\n\t\t},\r\n\t\tisLoad: false,\r\n\t},\r\n\tinit(obj){\r\n\t\tthis.RedT = obj;\r\n\t\tif (void 0 !== cc.RedT.setting.taixiu.chat_active) {\r\n\t\t\tthis.node.active = cc.RedT.setting.taixiu.chat_active;\r\n\t\t}\r\n\t},\r\n\tonLoad () {\r\n\t\tvar self = this;\r\n\t\tthis.keyHandle = function(t) {\r\n\t\t\treturn t.keyCode === cc.macro.KEY.tab ? (t.preventDefault && t.preventDefault(),\r\n\t\t\t\t!1) : t.keyCode === cc.macro.KEY.enter ? (BrowserUtil.focusGame(), self.onChatClick(),\r\n\t\t\t\tt.preventDefault && t.preventDefault(),\r\n\t\t\t\t!1) : void 0\r\n\t\t}\r\n\t},\r\n\tonEnable: function () {\r\n\t\tcc.sys.isBrowser && this.addEvent();\r\n\t\tif (!this.isLoad) {\r\n\t\t\tthis.getData();\r\n\t\t}else{\r\n\t\t\tthis.content.scrollToBottom(0);\r\n\t\t}\r\n\t},\r\n\tonDisable: function () {\r\n\t\tcc.sys.isBrowser && this.removeEvent();\r\n\t\tthis.clean();\r\n\t},\r\n\taddEvent: function() {\r\n\t\tBrowserUtil.getHTMLElementByEditBox(this.input).addEventListener(\"keydown\", this.keyHandle, !1);\r\n\t},\r\n\tremoveEvent: function() {\r\n\t\tBrowserUtil.getHTMLElementByEditBox(this.input).removeEventListener(\"keydown\", this.keyHandle, !1);\r\n\t},\r\n\tgetData: function(){\r\n\t\tthis.isLoad = true;\r\n\t\tcc.RedT.send({taixiu:{getLogChat: true}});\r\n\t},\r\n\tmessage: function(data, tobot = false){\r\n\t\tvar item = cc.instantiate(this.item);\r\n\t\t \r\n\t\tvar itemComponent = item.getComponent(cc.Label);\r\n\t\tif(data.top > 0 && data.top<4 )\r\n\t\titemComponent.string = data.user + ' (TOP '+(data.top)+') '+ ': ' + data.value;\r\n\t\telse\r\n\t\titemComponent.string = data.user + ': ' + data.value;\r\n\t\tvar name = item.children[0].getComponent(cc.Label);\r\n\t\tif(data.top > 0 && data.top<4 ){\r\n\t\t\tname.string = data.user+' (TOP '+(data.top)+') ';\r\n\t\t\tif(data.top == 1){\r\n\t\t\t\tname.node.color = new cc.Color(255, 0, 0);\r\n\t\t\t}else if(data.top == 2){\r\n\t\t\t\tname.node.color = new cc.Color(0, 255, 42);\r\n\t\t\t}else if(data.top == 3){\r\n\t\t\t\tname.node.color = new cc.Color(0, 156, 255);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}else{\r\n\t\t\tname.string = data.user;\r\n\t\t}\r\n\t\t\r\n\r\n\t\tthis.content.content.addChild(item);\r\n\t\tif(tobot && this.layout.node.height > 300 && this.layout.node.height-this.layout.node.position.y-134 < 70){\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\tthis.content.scrollToBottom (0);\r\n\t\t\t\t \r\n\t\t\t}.bind(this), 100);\r\n\t\t}\r\n\t},\r\n\tlogs: function(logs){\r\n\t\tif (logs.length) {\r\n\t\t\tvar self = this;\r\n\t\t\tPromise.all(logs.map(function(message){\r\n\t\t\t\treturn self.message(message);\r\n\t\t\t}))\r\n\t\t\t.then(result => {\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tthis.content.scrollToBottom(0);\r\n\t\t\t\t}.bind(this), 100);\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tonData: function(data){\r\n\t\tif (void 0 !== data.message) {\r\n\t\t\tthis.message(data.message, true);\r\n\t\t}\r\n\t\tif (void 0 !== data.logs) {\r\n\t\t\tthis.logs(data.logs);\r\n\t\t}\r\n\t},\r\n\tonChatClick: function() {\r\n\t\tif(helper.isEmpty(this.input.string)){\r\n\t\t\tthis.RedT.onData({err: \"Nhập nội dung để chat...\"});\r\n\t\t}else{\r\n\t\t\tcc.RedT.send({taixiu:{chat: this.input.string}});\r\n\t\t\tthis.onData({message:{user:cc.RedT.user.name, value:this.input.string}});\r\n\t\t\tthis.clean();\r\n\t\t}\r\n\t},\r\n\ttoggle: function(){\r\n\t\tthis.RedT.setTop();\r\n\t\tcc.RedT.audio.playClick();\r\n\t\tthis.node.active = cc.RedT.setting.taixiu.chat_active = !this.node.active;\r\n\t},\r\n\tclean: function(){\r\n\t\tthis.input.string = \"\";\r\n\t},\r\n\treset: function(){\r\n\t\tthis.content.content.destroyAllChildren();\r\n\t\tthis.node.active = false;\r\n\t},\r\n});\r\n"]}